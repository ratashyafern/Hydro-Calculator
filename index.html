<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SI-VEDIS | Sudin SDA Jaksel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map { height: 400px; border-radius: 12px; z-index: 1; }
        .u-ditch { border: 6px solid #4b5563; border-top: none; position: relative; transition: all 0.5s ease; margin: 0 auto; }
        .water { background: linear-gradient(180deg, #3b82f6 0%, #1e40af 100%); position: absolute; bottom: 0; width: 100%; transition: height 0.5s ease; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="bg-slate-50 font-sans text-slate-800">

    <nav class="bg-[#003366] text-white p-4 shadow-xl sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-4">
                <img src="https://upload.wikimedia.org/wikipedia/commons/b/b9/Logo_DKI_Jakarta.svg" class="h-10">
                <div>
                    <h1 class="font-black text-xl tracking-tight">SI-VEDIS <span class="text-yellow-400">JAKSEL</span></h1>
                    <p class="text-[10px] uppercase tracking-widest opacity-80">Sistem Verifikasi Hidrologi & Hidraulika</p>
                </div>
            </div>
            <button class="bg-cyan-500 hover:bg-cyan-400 text-white font-bold py-2 px-6 rounded-full text-sm shadow-lg transition-all">
                Export PDF
            </button>
        </div>
    </nav>

    <main class="container mx-auto p-6 space-y-8">
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 space-y-4">
                <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200">
                    <h3 class="font-bold mb-4 flex items-center gap-2 text-[#003366]">
                        <span>üìç</span> Analisis Spasial & Voronoi
                    </h3>
                    <div id="map"></div>
                </div>
            </div>
            
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <h3 class="font-bold mb-4 text-[#003366]">üìä Input Data Hujan</h3>
                <div class="space-y-4">
                    <button class="w-full py-3 border-2 border-dashed border-slate-300 rounded-xl text-slate-500 hover:bg-slate-50 transition-all text-sm font-medium">
                        + Upload GeoJSON / SHP
                    </button>
                    <div class="p-4 bg-slate-50 rounded-xl border border-slate-100">
                        <p class="text-xs text-slate-500 mb-2 font-semibold">STASIUN TERDETEKSI:</p>
                        <ul class="text-sm space-y-2 italic text-slate-400">
                            <li>Menunggu data stasiun...</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <h3 class="font-bold mb-6 text-[#003366]">‚öôÔ∏è Parameter Saluran</h3>
                <div class="space-y-5">
                    <div>
                        <label class="text-xs font-bold text-slate-500 uppercase">Pilih Dimensi U-Ditch</label>
                        <select id="size" class="w-full mt-1 p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-cyan-500 outline-none transition-all" onchange="runSim()">
                            <option value="40">U-Ditch 40 x 40 cm</option>
                            <option value="60" selected>U-Ditch 60 x 60 cm</option>
                            <option value="80">U-Ditch 80 x 80 cm</option>
                            <option value="100">U-Ditch 100 x 100 cm</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-slate-500 uppercase">Debit Rencana Q (m¬≥/s)</label>
                        <input type="range" id="qIn" min="0" max="2" step="0.1" value="0.5" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-cyan-500" oninput="runSim()">
                        <div class="flex justify-between text-sm font-bold mt-1 text-cyan-600">
                            <span id="qVal">0.5</span> m¬≥/s
                        </div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col items-center justify-center relative min-h-[450px]">
                <div id="statusBox" class="absolute top-6 right-6 px-6 py-2 rounded-full font-black text-white shadow-xl rotate-3 transition-all">
                    CHECKING...
                </div>
                
                <h3 class="text-slate-400 font-bold mb-12 uppercase tracking-tighter">Penampang Saluran Verifikasi</h3>
                
                <div id="uBox" class="u-ditch flex items-end overflow-hidden shadow-inner bg-slate-100">
                    <div id="water" class="water relative">
                        <div class="absolute top-0 left-0 w-full h-2 bg-white/30 animate-pulse"></div>
                    </div>
                </div>

                <div class="mt-12 grid grid-cols-2 gap-8 text-center">
                    <div>
                        <p class="text-[10px] font-bold text-slate-400 uppercase">Kapasitas Maksimal</p>
                        <p id="qMax" class="text-xl font-black text-[#003366]">0.00</p>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-slate-400 uppercase">Sisa Freeboard</p>
                        <p id="fb" class="text-xl font-black text-[#003366]">0.00</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Inisialisasi Peta
        var map = L.map('map').setView([-6.28, 106.82], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap'
        }).addTo(map);

        // Simulasi Hidraulika Sederhana
        function runSim() {
            const size = parseFloat(document.getElementById('size').value) / 100;
            const qIn = parseFloat(document.getElementById('qIn').value);
            const n = 0.013; // Manning Beton
            const s = 0.005; // Slope 0.5%
            
            // Update Visual Size
            const uBox = document.getElementById('uBox');
            uBox.style.width = (size * 350) + 'px';
            uBox.style.height = (size * 350) + 'px';

            // Hitung Q Max (Full)
            const area = size * size;
            const perimeter = size + (2 * size);
            const r = area / perimeter;
            const qMaxVal = (1/n) * area * Math.pow(r, 2/3) * Math.sqrt(s);

            // Water Level
            const level = Math.min((qIn / qMaxVal) * 100, 100);
            document.getElementById('water').style.height = level + '%';
            document.getElementById('qVal').innerText = qIn;
            document.getElementById('qMax').innerText = qMaxVal.toFixed(3) + " m¬≥/s";
            
            const freeboard = size - (size * (level/100));
            document.getElementById('fb').innerText = (freeboard * 100).toFixed(1) + " cm";

            const status = document.getElementById('statusBox');
            if(level >= 100) {
                status.innerText = "üö® NOT OK - LUBER!";
                status.className = "absolute top-6 right-6 px-6 py-2 rounded-full font-black text-white shadow-xl rotate-3 bg-red-600";
            } else if (level > 80) {
                status.innerText = "‚ö†Ô∏è WARNING - PENUH";
                status.className = "absolute top-6 right-6 px-6 py-2 rounded-full font-black text-white shadow-xl rotate-3 bg-orange-500";
            } else {
                status.innerText = "‚úÖ AMAN (SAFE)";
                status.className = "absolute top-6 right-6 px-6 py-2 rounded-full font-black text-white shadow-xl rotate-3 bg-emerald-500";
            }
        }

        window.onload = runSim;
    </script>
</body>
</html>
