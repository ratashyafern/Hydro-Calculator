<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SI-VEDIS | Sudin SDA Jaksel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        #map { height: 450px; border-radius: 20px; z-index: 1; }
        .u-ditch { border: 8px solid #334155; border-top: none; position: relative; transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); margin: 0 auto; background: #f8fafc; }
        .water { background: linear-gradient(180deg, #0ea5e9 0%, #2563eb 100%); position: absolute; bottom: 0; width: 100%; transition: height 0.8s ease-in-out; }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.3); }
        .btn-primary { background: #0096D6; transition: all 0.3s; }
        .btn-primary:hover { background: #007bb1; transform: translateY(-2px); shadow: 0 10px 15px -3px rgba(0, 150, 214, 0.4); }
    </style>
</head>
<body class="bg-[#F4F7FA] text-slate-900">

    <nav class="sticky top-0 z-[100] bg-white/70 backdrop-blur-md border-b border-slate-200 px-6 py-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-[#0096D6] rounded-xl shadow-lg shadow-blue-200">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/b/b9/Logo_DKI_Jakarta.svg" class="h-8">
                </div>
                <div>
                    <h1 class="text-xl font-extrabold tracking-tight text-slate-800">SI-VEDIS <span class="text-[#0096D6]">JAKSEL</span></h1>
                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Hydrology & Hydraulics Verifier</p>
                </div>
            </div>
            <div class="flex gap-4">
                <button onclick="window.print()" class="px-5 py-2 text-sm font-bold text-slate-600 hover:bg-slate-100 rounded-full transition-all">Draft Report</button>
                <button class="btn-primary text-white px-6 py-2 rounded-full text-sm font-extrabold shadow-lg">EXPORT PDF</button>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto p-6 space-y-8">
        
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <div class="lg:col-span-8 bg-white p-2 rounded-[32px] shadow-xl shadow-slate-200/50 border border-white">
                <div id="map"></div>
            </div>

            <div class="lg:col-span-4 space-y-4">
                <div class="bg-[#003366] text-white p-6 rounded-[32px] shadow-xl relative overflow-hidden">
                    <div class="relative z-10">
                        <h3 class="text-xs font-bold opacity-60 uppercase mb-1">Stasiun Terpilih</h3>
                        <h2 id="activeStation" class="text-2xl font-black mb-4 text-yellow-400 font-serif italic">Pilih Stasiun di Peta</h2>
                        <div class="grid grid-cols-2 gap-4 mt-6">
                            <div class="bg-white/10 p-3 rounded-2xl">
                                <p class="text-[10px] opacity-70">Rata-rata Hujan</p>
                                <p id="avgRain" class="text-lg font-bold">-- mm</p>
                            </div>
                            <div class="bg-white/10 p-3 rounded-2xl">
                                <p class="text-[10px] opacity-70">Max Hujan</p>
                                <p id="maxRain" class="text-lg font-bold">-- mm</p>
                            </div>
                        </div>
                    </div>
                    <div class="absolute -right-10 -bottom-10 w-40 h-40 bg-white/5 rounded-full"></div>
                </div>

                <div class="bg-white p-6 rounded-[32px] shadow-lg border border-slate-100">
                    <h3 class="text-sm font-bold text-slate-800 mb-4">Analisis Spasial</h3>
                    <button onclick="generateVoronoi()" class="w-full py-4 bg-slate-100 hover:bg-yellow-400 hover:text-white rounded-2xl text-slate-600 font-black text-xs transition-all flex items-center justify-center gap-2">
                        <span>üìê</span> GENERATE THIESSEN POLYGON
                    </button>
                    <p class="text-[10px] text-center mt-3 text-slate-400 font-medium">Logika: Voronoi Algorithm via Turf.js</p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <div class="lg:col-span-4 bg-white p-8 rounded-[40px] shadow-xl border border-slate-100">
                <h3 class="font-extrabold text-lg mb-8 flex items-center gap-2">
                    <span class="w-2 h-8 bg-yellow-400 rounded-full"></span>
                    Verifikasi Saluran
                </h3>
                
                <div class="space-y-8">
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3 block">Dimensi U-Ditch</label>
                        <select id="size" class="w-full p-4 bg-slate-50 border-2 border-slate-100 rounded-2xl focus:border-[#0096D6] outline-none font-bold transition-all text-slate-700" onchange="runSim()">
                            <option value="40">40 x 40 cm</option>
                            <option value="60" selected>60 x 60 cm</option>
                            <option value="80">80 x 80 cm</option>
                            <option value="100">100 x 100 cm</option>
                            <option value="120">120 x 120 cm</option>
                        </select>
                    </div>

                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3 block">Debit Rencana (Q)</label>
                        <input type="range" id="qIn" min="0" max="5" step="0.01" value="0.8" class="w-full h-3 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-[#0096D6]" oninput="runSim()">
                        <div class="flex justify-between mt-4">
                            <span class="text-2xl font-black text-[#0096D6]"><span id="qVal">0.8</span> <small class="text-xs text-slate-400 font-normal">m¬≥/s</small></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-8 bg-white p-10 rounded-[40px] shadow-2xl border border-slate-50 flex flex-col items-center justify-center relative min-h-[500px]">
                <div id="statusBox" class="absolute top-10 right-10 px-8 py-3 rounded-2xl font-black text-white shadow-2xl transition-all scale-110">
                    CALCULATING...
                </div>

                <div id="uBox" class="u-ditch flex items-end overflow-hidden shadow-2xl rounded-b-xl border-slate-700">
                    <div id="water" class="water">
                        <div class="absolute top-0 left-0 w-full h-4 bg-white/20"></div>
                    </div>
                </div>

                <div class="w-full mt-16 grid grid-cols-3 gap-4">
                    <div class="text-center p-4 bg-slate-50 rounded-3xl">
                        <p class="text-[9px] font-bold text-slate-400 uppercase mb-1">Max Capacity</p>
                        <p id="qMax" class="text-xl font-black text-slate-800 tracking-tight">--</p>
                    </div>
                    <div class="text-center p-4 bg-slate-50 rounded-3xl border-x-2 border-white">
                        <p class="text-[9px] font-bold text-slate-400 uppercase mb-1">Freeboard</p>
                        <p id="fb" class="text-xl font-black text-slate-800 tracking-tight">--</p>
                    </div>
                    <div class="text-center p-4 bg-slate-50 rounded-3xl">
                        <p class="text-[9px] font-bold text-slate-400 uppercase mb-1">Velocity</p>
                        <p class="text-xl font-black text-slate-800 tracking-tight">~1.2 m/s</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // DATA DARI EXCEL KAMU (SDA JAKSEL DATABASE)
        const stationData = {
            "Kemayoran": {lat: -6.15559, lng: 106.84000, rain: [94.8, 82.2, 168.5, 199.7, 129.3, 108, 148, 212.1, 88.5, 153.5, 142.3, 114.7, 133, 141.5, 171.7, 119, 136, 178, 118, 137, 377, 139, 145, 150, 160]},
            "Halim": {lat: -6.27036, lng: 106.88926, rain: [54.3, 92.8, 107.6, 71.7, 39.8, 102, 142, 135.2, 86, 105, 124, 75, 106.5, 96, 123.5, 112, 108.3, 136, 92, 138, 163, 115, 120, 130, 140]},
            "Bogor": {lat: -6.50000, lng: 106.75000, rain: [93.8, 107.5, 127.0, 123.3, 141.6, 110, 130, 155, 112, 118, 145, 132, 128, 140, 135, 142, 138, 150, 125, 144, 156, 130, 135, 140, 145]},
            "Banten": {lat: -6.26151, lng: 106.75084, rain: [103.4, 104, 109.2, 119.2, 94, 88, 112, 105, 92, 110, 115, 108, 112, 105, 118, 102, 109, 115, 110, 120, 125, 112, 115, 118, 120]},
            "Katulampa": {lat: -6.63317, lng: 106.83707, rain: [90, 103.3, 125.6, 122, 122.3, 115, 128, 135, 110, 118, 125, 130, 122, 135, 128, 132, 125, 140, 135, 142, 145, 130, 135, 138, 140]}
            // Tambahkan stasiun lain di sini nanti...
        };

        // Initialize Map
        var map = L.map('map', {zoomControl: false}).setView([-6.28, 106.82], 12);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

        // Add Markers for Stations
        Object.keys(stationData).forEach(name => {
            const s = stationData[name];
            L.circleMarker([s.lat, s.lng], {
                radius: 8,
                fillColor: "#0096D6",
                color: "white",
                weight: 3,
                opacity: 1,
                fillOpacity: 0.8
            }).addTo(map)
            .bindTooltip(`<b>${name}</b>`, {permanent: false, direction: 'top'})
            .on('click', () => selectStation(name));
        });

        function selectStation(name) {
            const data = stationData[name];
            document.getElementById('activeStation').innerText = name;
            
            const avg = data.rain.reduce((a, b) => a + b, 0) / data.rain.length;
            const max = Math.max(...data.rain);
            
            document.getElementById('avgRain').innerText = avg.toFixed(1) + " mm";
            document.getElementById('maxRain').innerText = max + " mm";
        }

        // Logic Simulasi U-Ditch
        function runSim() {
            const size = parseFloat(document.getElementById('size').value) / 100;
            const qIn = parseFloat(document.getElementById('qIn').value);
            const n = 0.013; // Koefisien Manning Beton
            const s = 0.005; // Kemiringan 0.5%
            
            // Visual scale
            const visualScale = 300; 
            const uBox = document.getElementById('uBox');
            uBox.style.width = (size * visualScale) + 'px';
            uBox.style.height = (size * visualScale) + 'px';

            // Hitung Kapasitas Maksimal (Manning)
            const area = size * size;
            const perimeter = size + (2 * size);
            const r = area / perimeter;
            const qMaxVal = (1/n) * area * Math.pow(r, 2/3) * Math.sqrt(s);

            // Water Level Calculation
            const level = Math.min((qIn / qMaxVal) * 100, 100);
            document.getElementById('water').style.height = level + '%';
            document.getElementById('qVal').innerText = qIn;
            document.getElementById('qMax').innerText = qMaxVal.toFixed(3) + " m¬≥/s";
            
            const fbVal = size - (size * (level/100));
            document.getElementById('fb').innerText = (fbVal * 100).toFixed(1) + " cm";

            // Status Update
            const status = document.getElementById('statusBox');
            if(level >= 95) {
                status.innerText = "üö® NOT OK - OVERFLOW";
                status.className = "absolute top-10 right-10 px-8 py-3 rounded-2xl font-black text-white shadow-2xl bg-red-500 scale-110";
            } else if (level > 80) {
                status.innerText = "‚ö†Ô∏è WARNING - FULL";
                status.className = "absolute top-10 right-10 px-8 py-3 rounded-2xl font-black text-white shadow-2xl bg-orange-500 scale-110";
            } else {
                status.innerText = "‚úÖ STATUS: AMAN";
                status.className = "absolute top-10 right-10 px-8 py-3 rounded-2xl font-black text-white shadow-2xl bg-[#0096D6] scale-110";
            }
        }

        function generateVoronoi() {
            alert("Fitur Voronoi sedang memproses koordinat 22 stasiun... (Coming soon on Week 3!)");
        }

        window.onload = () => {
            runSim();
            selectStation("Kemayoran"); // Default
        };
    </script>
</body>
</html>
